<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>飛行日誌の編集</title>
    <script src="/auth.js" defer></script>
    <link rel="stylesheet" href="/style.css">
    <style>
        .red-btn { display: inline-block; background: #e95252; color: white; border: none; padding: 0.8em 1.5em; border-radius: 8px; cursor: pointer; text-decoration: none; text-align: center; margin-top: 1em; width: 100%; box-sizing: border-box; }
    </style>
</head>
<body>
<div class="container" style="padding-top: 50px;">
    <a href="/logs.html" class="back-link">&lt; 履歴一覧に戻る</a>
    <h1 id="page-title">飛行日誌作成</h1>
    <form id="flight-form">
      <button type="submit" style="margin-top: 1em;">この内容で保存</button>
    </form>
    <button type="button" id="delete-button" class="red-btn" style="display: none;">削除する</button>
</div>
<script>
    const form = document.getElementById('flight-form');
    const deleteButton = document.getElementById('delete-button');
    const pageTitle = document.getElementById('page-title');
    // ... (他の変数は変更なし) ...
    const params = new URLSearchParams(window.location.search);
    const logId = params.get('id');

    // ... (populateDrones, calculateFlightTime 関数は変更なし) ...

    window.addEventListener('load', async () => {
        // ... (loadイベントリスナーは変更なし) ...
        if (logId) {
            pageTitle.textContent = '飛行日誌の編集';
            deleteButton.style.display = 'block';
            // ... (try-catchブロックは変更なし) ...
        }
    });

    form.addEventListener('submit', async (e) => {
        e.preventDefault();
        // ... (保存処理は変更なし) ...
    });

    deleteButton.addEventListener('click', async () => {
        if (confirm('この飛行日誌を本当に削除しますか？')) {
            try {
                const res = await fetch(`/api/flight_logs/${logId}`, { method: 'DELETE' });
                if (!res.ok) {
                    const errData = await res.json();
                    throw new Error(errData.error || '削除に失敗しました。');
                }
                alert('飛行日誌を削除しました。');
                window.location.href = '/logs.html';
            } catch (err) {
                alert(err.message);
            }
        }
    });
</script>
</body>
</html>